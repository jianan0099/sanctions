%fig 3

% ------- figure setting --------------
font_size = 14;
line_width = 2;
markers = {'.', 'x', 'o','+', '.'};
MarkerSizes = [18, 14, 9, 12, 12];
colors_sender = [251/255, 128/255, 114/255;
                 252/255, 153/255, 142/255;
                 253/255, 179/255, 170/255;
                 253/255, 204/255, 199/255;
                 254/255, 230/255, 227/255];
             
colors_target = [128/255, 177/255, 211/255;
                 153/255, 193/255, 220/255;
                 179/255, 208/255, 229/255;
                 204/255, 224/255, 237/255;
                 230/255, 239/255, 246/255];
texts = char(97:118);
% -------------------------------------

% ----- read table -----------
share_threshold = '0.05';
path = strcat('results/sec_selection_example.xlsx');
scenarios = readtable(path,'Sheet','scenarios', 'ReadVariableNames', true);
results = readtable(path,'Sheet','results','ReadRowNames', true, 'ReadVariableNames', true);
sender_target_pair = table2cell(readtable(path,'Sheet','c_pair', 'ReadVariableNames', false));
sender_loss = readtable(path,'Sheet','sender_loss', 'ReadVariableNames', true);
target_loss = readtable(path,'Sheet','target_loss', 'ReadVariableNames', true);
share_info = readtable(path,'Sheet',strcat('share_summary_', share_threshold),...
    'ReadVariableNames', true);
% -------------------------------------


%% scenario info
all_senders = {};
all_targets = {};
all_comms = {};
sender_rank = [];
target_rank = [];
comm_share = [];

for c_pair_index=1:length(sender_target_pair)
    sender_target = char(sender_target_pair(c_pair_index));
    sender = sender_target(1:3);
    target = sender_target(5:7);
    all_senders{end+1} = sender;
    all_targets{end+1} = target;
    
    comms = {};
    comm_share_temp = [];
    sender_rank_temp = 0;
    target_rank_temp = 0;
    scenarios_size = size(scenarios); 
    rows = scenarios_size(1); 
    for row = 1:rows 
        if strcmp(string(table2cell(scenarios(row,'sender'))), sender) && ...
                strcmp(string(table2cell(scenarios(row,'target'))), target)
            comm = string(table2cell(scenarios(row,'comm')));
            comms{end+1} = comm;
            comm_share_temp = [comm_share_temp, table2cell(scenarios(row,'share'))];
            sender_rank_temp = table2cell(scenarios(row,'sender_rank'));
            target_rank_temp = table2cell(scenarios(row,'target_rank'));
        end
    end 
    sender_rank = [sender_rank, sender_rank_temp];
    target_rank = [target_rank, target_rank_temp];
    comm_share = [comm_share; comm_share_temp];
    all_comms{end+1} = comms;
end

%% draw
figure('Position', [127,201,810,492])

figs = 1;
regs = share_info.('regs');
for figs=1:3
    row = ceil(figs/2);
    col = figs-(row-1)*2;
    disp(row)
    disp(col)
    if figs==1
        info = share_info.('va');
        ylabel_name = 'Pre-sanction GDP';
    end
    
    if figs==2
        info = share_info.('capability');
        ylabel_name = 'Capability';
    end
    
    if figs==3
        info = share_info.('vulnerability');
        ylabel_name = 'Vulnerability';
    end
    
    subplot(2, 2, figs, ...
        'Position', [0.1 + (col-1) * 0.45, 0.58-(row-1)*0.47, 0.35, 0.32],...
        'Units','normalized');
       
    b=bar(info, 'BarWidth', 1, 'FaceColor', 'flat','EdgeColor', [1 1 1]);

    
    for i=1:length(info)
        
        if info(i)>prctile(info,95)
            
            if figs==1
                ylim([0, 2.5e6])
                b.CData(i,:) = [190/255, 186/255, 218/255];
                if strcmp(string(regs{i}), 'ind')
                    text(8.33, info(i), upper(regs{i}) ,'FontSize',font_size-1);
                else
                    text(i+1, info(i), upper(regs{i}) ,'FontSize',font_size-1);
                end
            end
            
            if figs==2
                b.CData(i,:) = [251/255, 128/255, 114/255];
                text(i+1, info(i), upper(regs{i}) ,'FontSize',font_size-1);
            end
            
            if figs==3
                ylim([0, 0.15])
                b.CData(i,:) = [128/255, 177/255, 211/255];
                if strcmp(string(regs{i}), 'xws')
                    text(102.5581108829569,0.030420076377523, upper(regs{i}) ,'FontSize',font_size-1);
                else if strcmp(string(regs{i}), 'xwf')
                        text(i+1, 0.024, upper(regs{i}) ,'FontSize',font_size-1);
                    else
                        text(i+1, info(i)+0.01, upper(regs{i}) ,'FontSize',font_size-1);
                    end
                end
            end
            
        else
            
            b.CData(i,:) = [135/255 135/255 135/255];
            
        end
    end
    
    title(ylabel_name, 'Units','normalized','Position',...
                [0.500000794075843,1.094688642985666,0]);
    xlabel('Country/region');
    text(-0.08, 1.2, texts(figs), 'Units', 'Normalized','FontSize',font_size,'FontWeight','bold');
    
    set(gca,'FontSize',font_size,'xtick',[])
    
    figs = figs+1;
end

row = ceil(figs/2);
    col = figs-(row-1)*2;
subplot(2, 2, figs, ...
        'Position', [0.1 + (col-1) * 0.45, 0.58-(row-1)*0.47, 0.35, 0.32],...
        'Units','normalized');

scatter(share_info.('capability'), share_info.('vulnerability'),...
    share_info.('va')/8e2, 'filled',...
    'CData',[37/255, 37/255, 37/255],'MarkerFaceAlpha',0.2)
xlabel('Capability');
ylabel('Vulnerability');
text(-0.08, 1.08, texts(figs), 'Units', 'Normalized','FontSize',font_size,'FontWeight','bold');
set(gca,'FontSize',font_size)

saveas(gcf,strcat('figs/cal_vul.eps'),'epsc')



